<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tittle</title>

    <!-- bootstrap -->
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

    <!-- google font -->
    <link rel="preconnect" href="https://fonts.gassets.com">
    <link rel="preconnect" href="https://fonts.gassets.com">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&family=Lobster&display=swap" rel="stylesheet">

    <!-- owl-carousel -->
    <link rel="stylesheet" href="assets/owl/css/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/owl/css/owl.theme.default.min.css">

    <!-- my css files -->
    <link rel="stylesheet" href="assets/css/base.css">
    <link rel="stylesheet" href="assets/css/scss/style.css">
</head>
<style>p{margin-bottom: 0.5rem;}.form-file::-webkit-file-upload-button {visibility: hidden;display: none;}
/*.form-file::before{
  content: url(test.svg)' upload csv file ';text-align: center; 
  content: 'Select csv files';
  visibility: visible;
  display: block;
  width:80%;
  text-align: center;
  margin-left:auto;
  margin-right:auto!important;
  background: rgba(255, 0, 0, 0.904);
  border-radius: 3px;
  padding: 5px 8px;
  margin-right:8px;
  font-size: 1.4rem!important;
  outline: none;
  white-space: nowrap;
  -webkit-user-select: none;
  cursor: pointer;
  color:white; font-size: 15px;}.form-file:after{display: none;}*/.row, .form-group, .shadow, .shadow-sm {background-color: white;}.bg-danger{background-color: rgba(255, 0, 0, 0.904)!important;}
  </style>
<body class="bg-light">
<div class="p-2">
    <form class="form-inline">

      <div class="form-group px-2 py-4 my-3 shadow">
        <label for="csvfile" class="w-100 text-center px-3 py-2 text-light" style="font-size:1.3rem;"><div class="bg-danger text-center py-2"><span style="padding-right:10px;"><i class="bi bi-upload"></i></span>upload csv file</div></label>
        <input style="display: none;" type="file" id="csvfile" onchange="(function(){$('#typetour').remove(); $('#typematch').remove();$('#type').val(1);onChange(event)})()" class="form-file p-2 text-center" accept=".csv" required />      </div>
      <div class="p-2 mt-3 mb-2 shadow" id="selectarea">
      <select onchange="(function(){$('#typetour').remove(); $('#typematch').remove();$('#type').val(1);onChange(event)})()" class="form-select my-2" aria-label="Default select example" id="time">
        <option value="0" selected>Lifetime</option>
        <option value="1">Today</option>
        <option value="2">Yesterday</option>
        <option value="7">Last 7 Days</option>
        <option value="30">Last 30 Days</option>
      </select>

      <select class="form-select mt-3 mb-2" onchange="typeChanged(this.value)" aria-label="Default select example" id="type">
        <option value="1" selected>All</option>
        <option value="2">Tour-Wise</option>
      </select>
    </form>
  </div>
</div>
    

<div class="container-fluid m-0 p-2">
<div class="row p-2 m-0 shadow">
  <div class="col-12 text-center"><h4 class="mb-0 mt-1">Investment Analysis</h4></div>
  <div class="col-6 p-0 text-center"><div class="m-3 py-2 alert-success">
  <p>investment</p><p style="font-weight:bold;"><span>₹</span>
    <span id="investment">0</span></p>
  </div></div>

  <div class="col-6 p-0 text-center"><div class="m-3 py-2 alert-warning">
    <p>winning</p><p style="font-weight:bold;"><span>₹</span>
      <span id="winning">0</span></p>
    </div></div>

  <div class="col-6 p-0 text-center"><div class="m-3 py-2 alert-secondary">
    <p>Profit</p><p style="font-weight:bold;"><span>₹</span>
      <span id="profit">0</span></p>
    </div></div>

  <div class="col-6 p-0 text-center"><div class="m-3 py-2 alert-danger">
    <p>loss</p><p style="font-weight:bold;"><span>₹</span>
      <span id="loss">0</span></p>
    </div></div>

</div>
</div>
<div class="container-fluid m-0 p-2">
  <div class="row p-2 m-0 shadow">
    <div class="col-12 text-center"><h4 class="mb-0 mt-1">Wallet Analysis</h4></div>
    <div class="col-6 p-0 text-center"><div class="m-3 py-2 alert-success">
    <p>Deposits</p><p style="font-weight:bold;"><span>₹</span>
      <span id="deposits">0</span></p>
    </div></div>
  
    <div class="col-6 p-0 text-center"><div class="m-3 py-2 alert-warning">
      <p>Withdraws</p><p style="font-weight:bold;"><span>₹</span>
        <span id="withdraws">0</span></p>
      </div></div>
  
    <div class="col-6 p-0 text-center"><div class="m-3 py-2 alert-secondary">
      <p>Profit</p><p style="font-weight:bold;"><span>₹</span>
        <span id="wprofit">0</span></p>
      </div></div>
  
    <div class="col-6 p-0 text-center"><div class="m-3 py-2 alert-danger">
      <p>loss</p><p style="font-weight:bold;"><span>₹</span>
        <span id="wloss">0</span></p>
      </div></div>

  </div>
  </div>
  <div class="mx-2 text-center p-0" style="background: -webkit-linear-gradient(top, #e3e3e3, #f9f9f9);"><small class="font-weight-bold" style="background: -webkit-linear-gradient(top, #e3e3e3, #f9f9f9); color:#bdbbbb;">created with ❤ by dev</small></div>
<!-- bootstrap -->
<script src="assets/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- jquery -->
<script src="assets/x-jquery/jquery-2.2.4.min.js"></script>
<script src="font.min.js"></script>
<!--<script src="assets/js/papaparse.min.js"></script>-->

<!-- my javascript -->
<!--<script>
var today = (new Date());
var tourArrayObj;
var jData;
var tourArray;
const format = {0: "TransactionId", 1: "TransactionDate", 2: "Tour",
3: "Round", 4: "Amount", 5: "Description"}
var invest; var deposits; var withdraws;
var winning;

const cfile = document.getElementById('csvfile');
function onChange(event) {
  console.log("running");
  let fileUpload = $("#csvfile").get(0);
  let files = fileUpload.files[0];
  var reader = new FileReader();
  if (files.name.toLowerCase().lastIndexOf(".csv") == -1) {
    alert("Please upload only CSV files");
    return;
  }
  //let bytes = 50000;

  reader.onload = function(evt) {
    let lines = evt.target.result;
    //convertToJson(lines);
    jData = CSVToArray(lines);
    calculation(jData);
  }
  reader.readAsText(files);


};

function CSVToArray(strData, strDelimiter) {
    strDelimiter = (strDelimiter || ",");
    let objPattern = new RegExp(
      (
        "(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +
        "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +
        "([^\"\\" + strDelimiter + "\\r\\n]*))"
        ),
      "gi"
      );
    var arrData = [[]];
    let arrMatches = null;
    while (arrMatches = objPattern.exec(strData)) {
      let strMatchedDelimiter = arrMatches[1];
      let strMatchedValue = [];
      if (strMatchedDelimiter.length && (strMatchedDelimiter != strDelimiter)) {
        arrData.push([]);
      }
      if (arrMatches[2]) {
        strMatchedValue = arrMatches[2].replace(new RegExp("\"\"", "g"),"\"");
      } else {
        strMatchedValue = arrMatches[3];
      }
      arrData[arrData.length - 1].push(strMatchedValue);
    }
    return (arrData);
  }

function calculation(data){
  invest = 0;
  winning = 0;
  deposits = 0;
  withdraws = 0;
  tourArray = [];
  tourArrayObj = [];
  //console.log('today = ', today);
  data.forEach(function(item, index){
    if(index != 0){
      //console.log('index of ', item, ' is ',index);
      calculateWithFilter(item);
    } 
  });
  //console.log('invest = ', winning)
  $('#investment').html(Math.ceil(invest));
  $('#winning').html(Math.ceil(winning));
  $('#deposits').html(Math.ceil(deposits));
  $('#withdraws').html(Math.ceil(withdraws));
  var profit = Math.ceil(winning) - Math.ceil(invest);
  if(profit>0){
    $('#profit').html(profit);
    $('#loss').html(0);
  }else if(profit<0){
    $('#loss').html(-1 *profit);
    $('#profit').html(0);
  }else{
    $('#profit').html(0);
    $('#loss').html(0);
  }

  var wprofit = parseInt(Math.ceil(withdraws) - Math.ceil(deposits));
  if(wprofit>0){
    $('#wprofit').html(wprofit);
    $('#wloss').html(0);
  }else if(profit<0){
    $('#wloss').html(-1 *wprofit);
    $('#wprofit').html(0);
  }else{
    $('#wloss').html(0);
    $('#wprofit').html(0);
  }
  
}


//const format = {0: "TransactionId", 1: "TransactionDate", 2: "Tour",
//3: "Round", 4: "Amount", 5: "Description"}

//Refunded,Withdrew Cash,Deposited Cash,Joined A Contest,Won A Contest, Same Team Refund Cash Bonus, Level Up Cash Bonus Credited

function calculateWithFilter(data){
  if(timeFilter(data[1])){

    if(!tourArray.includes(data[2]) && data[2] != undefined){
      tourArray.push(data[2]);
      tourArrayObj.push({tour:data[2],match:[]})
    }else if(data[2] != undefined){
      let dd = tourArrayObj.filter(function(tour){return tour.tour == data[2];}).pop();
      if(!dd['match'].includes(data[3])){
        dd['match'].push(data[3]);
      }
    }

    if(typeFilter(data[2])){
      if(matchFiler(data[3])){      

        //invest
        if(data[5]=='Joined A Contest'){
          invest += parseInt(data[4]);
        }else if(data[5]=='Refunded'){
          invest += parseFloat(data[4]);
        }  
        else if(data[5]=='Refunded'){
          invest -= parseInt(data[4]);
        }

        //winning
        else if(data[5]=='Won A Contest'){
          winning += parseFloat(data[4]);
        }

      }
    }
    
    //deposits
    if(data[5]=='Deposited Cash'){
      deposits += parseFloat(data[4]);
    }

    //withdraws
    else if(data[5]=='Withdrew Cash'){
      withdraws += parseFloat(data[4]);
    }
  }  

}

function timeFilter(date){
  const time = document.getElementById('time');
  if(date == undefined){
    return false;
  }
  else if(time.value==1){
    var d = new Date();
    var xdate = new Date(date);
    d.setDate(d.getDate()-1);
    //console.log(d);
    if (xdate >= d){
      return true;
    }else{return false;}
  }
  else if(time.value==2){
    var d = new Date();
    var xdate = new Date(date);
    d.setDate(d.getDate()-3);
    //console.log(d);
    if (xdate >= d){
      return true;
    }else{return false;}
  }
  else if(time.value==7){
    var d = new Date();
    var xdate = new Date(date);
    d.setDate(d.getDate()-7);
    //console.log(d);
    if (xdate >= d){
      return true;
    }else{return false;}
  }
  else if(time.value==30){
    var d = new Date();
    var xdate = new Date(date);
    d.setDate(d.getDate()-30);
    //console.log(d);
    if (xdate >= d){
      return true;
    }else{return false;}
  }else{
    return true;
  }

  //console.log('time = ' ,(today > (new Date(date))));
  //console.log(time.value);
}

function typeChanged(type){
  //console.log(tourArrayObj);
  var blocktop = `<select class="form-select mt-3 mb-2" onchange="typetourChanged(this.value)" aria-label="Default select example" id="typetour"><option value="0" selected>select match</option>`;
  var text = '';
  tourArray.forEach(function(item, index){
    //console.log('index of ', item, ' is ',index);
    text += `<option value="`+item+`">`+item+`</option>`;
  });
  var blockbottom = `</select> `;

  var block = blocktop+text+blockbottom;
  if(type==1){
    $('#typetour').remove();
    $('#typematch').remove();
  }else{
    //console.log(text);
    if(!$('#typetour').length){
      $('#selectarea').append(block);
    }else{
      $('#typetour').html('<option value="0" selected>select match</option>'+text);
    }
  }
  onChange(event);
}

function typetourChanged(type){
  var blocktop = `<select class="form-select mt-3 mb-2" onchange="onChange(event)" aria-label="Default select example" id="typematch"><option value="0" selected>select match</option>`;
  var text = '';
  var blockbottom = `</select> `;

  var ddd = tourArrayObj.filter(function(tour){return tour.tour == $('#typetour').val();}).pop();
  //console.log('ddd= ',ddd,', tourval = ', $('#typetour').val());
  ddd['match'].forEach(function(item, index){
    text += `<option value="`+item+`">`+item+`</option>`;
  });

  let block = blocktop+text+blockbottom;
  //console.log(block)
  if(!$('#typematch').length){
    $('#selectarea').append(block);
  }else{
    $('#typematch').html('<option value="0" selected>select match</option>'+text);
  }
  onChange(event);
}

function typeFilter(tourdata){
  //console.log('val = ',$('#typetour').val())
  if($('#typetour').length){
    if($('#typetour').val()==0){
    return true;
    }else if(tourdata==$('#typetour').val()){
      return true;
    }else{
      return false;
    }
  }else{
    return true;
  }
}

function matchFiler(matchdata){
  if($('#typematch').length){
    if($('#typematch').val()==0){
      return true;
    }else if(matchdata==$('#typematch').val()){
      return true;
    }else{
      return false;
    }
  }else{
    return true;
  }
}

</script>-->

</body>
</html>