function onChange(t){console.log("running");let e=$("#csvfile").get(0),a=e.files[0];var n=new FileReader;-1!=a.name.toLowerCase().lastIndexOf(".csv")?(n.onload=function(t){let e=t.target.result;jData=CSVToArray(e),calculation(jData)},n.readAsText(a)):alert("Please upload only CSV files")}function CSVToArray(t,e){e=e||",";let a=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi");var n=[[]];let l=null;for(;l=a.exec(t);){let t=l[1],a=[];t.length&&t!=e&&n.push([]),a=l[2]?l[2].replace(new RegExp('""',"g"),'"'):l[3],n[n.length-1].push(a)}return n}function calculation(t){invest=0,winning=0,deposits=0,withdraws=0,tourArray=[],tourArrayObj=[],t.forEach(function(t,e){0!=e&&calculateWithFilter(t)}),$("#investment").html(Math.ceil(invest)),$("#winning").html(Math.ceil(winning)),$("#deposits").html(Math.ceil(deposits)),$("#withdraws").html(Math.ceil(withdraws));var e=Math.ceil(winning)-Math.ceil(invest);e>0?($("#profit").html(e),$("#loss").html(0)):e<0?($("#loss").html(-1*e),$("#profit").html(0)):($("#profit").html(0),$("#loss").html(0));var a=parseInt(Math.ceil(withdraws)-Math.ceil(deposits));a>0?($("#wprofit").html(a),$("#wloss").html(0)):e<0?($("#wloss").html(-1*a),$("#wprofit").html(0)):($("#wloss").html(0),$("#wprofit").html(0))}function calculateWithFilter(t){if(timeFilter(t[1])){if(tourArray.includes(t[2])||null==t[2]){if(null!=t[2]){let e=tourArrayObj.filter(function(e){return e.tour==t[2]}).pop();e.match.includes(t[3])||e.match.push(t[3])}}else tourArray.push(t[2]),tourArrayObj.push({tour:t[2],match:[]});typeFilter(t[2])&&matchFiler(t[3])&&("Joined A Contest"==t[5]?invest+=parseInt(t[4]):"Refunded"==t[5]?invest-=parseFloat(t[4]):"Won A Contest"==t[5]&&(winning+=parseFloat(t[4]))),"Deposited Cash"==t[5]?deposits+=parseFloat(t[4]):"Withdrew Cash"==t[5]&&(withdraws+=parseFloat(t[4]))}}function timeFilter(t){const e=document.getElementById("time");if(null==t)return!1;if(1==e.value){var a=new Date,n=new Date(t);return a.setDate(a.getDate()-1),n>=a}if(2==e.value){a=new Date,n=new Date(t);return a.setDate(a.getDate()-3),n>=a}if(7==e.value){a=new Date,n=new Date(t);return a.setDate(a.getDate()-7),n>=a}if(30==e.value){a=new Date,n=new Date(t);return a.setDate(a.getDate()-30),n>=a}return!0}function typeChanged(t){var e='<select class="form-select mt-3 mb-2" onchange="typetourChanged(this.value)" aria-label="Default select example" id="typetour"><option value="0" selected>select match</option>',a="";tourArray.forEach(function(t,e){a+='<option value="'+t+'">'+t+"</option>"});var n="</select> ",l=e+a+n;1==t?($("#typetour").remove(),$("#typematch").remove()):$("#typetour").length?$("#typetour").html('<option value="0" selected>select match</option>'+a):$("#selectarea").append(l),onChange(event)}function typetourChanged(t){var e='<select class="form-select mt-3 mb-2" onchange="onChange(event)" aria-label="Default select example" id="typematch"><option value="0" selected>select match</option>',a="",n="</select> ",l=tourArrayObj.filter(function(t){return t.tour==$("#typetour").val()}).pop();l.match.forEach(function(t,e){a+='<option value="'+t+'">'+t+"</option>"});let r=e+a+n;$("#typematch").length?$("#typematch").html('<option value="0" selected>select match</option>'+a):$("#selectarea").append(r),onChange(event)}function typeFilter(t){return!$("#typetour").length||(0==$("#typetour").val()||t==$("#typetour").val())}function matchFiler(t){return!$("#typematch").length||(0==$("#typematch").val()||t==$("#typematch").val())}var tourArrayObj,jData,tourArray,today=new Date;const format={0:"TransactionId",1:"TransactionDate",2:"Tour",3:"Round",4:"Amount",5:"Description"};var invest,deposits,withdraws,winning;const cfile=document.getElementById("csvfile");